<?xml version="1.0" encoding="UTF-8"?>
<sequence>
	<!-- Start Variable depending on the installation machine-->
	<setVariable name="instDir">
		<string>/home/toolbox/ACS/</string>
	</setVariable>
	<!-- End Variable depending on the installation machine-->
	<execute>
		<procedure>
			<stringCat>
				<variable name="instDir"/>
				<string>customizeScript.xml</string>
			</stringCat>
		</procedure>
	</execute>
	<setVariable name="xml2sql">
		<stringCat>
			<variable name="instDir"/>
			<string>Search2SQL.xsl</string>
		</stringCat>
	</setVariable>
	<setVariable name="txml2sql">
		<stringCat>
			<variable name="instDir"/>
			<string>TempSearch2SQL.xsl</string>
		</stringCat>
	</setVariable>
	<setVariable name="presentation">
		<xPath xmlns:eoli="http://earth.esa.int/XML/eoli" xmlns:mass="http://www.esa.int/mass">
			<xmlRequest/>
			<string>mass:processSearchInputMsg/mass:searchInput/eoli:searchRequest/eoli:presentation</string>
		</xPath>
	</setVariable>
	<setVariable name="cursor">
		<xPath xmlns:eoli="http://earth.esa.int/XML/eoli" xmlns:mass="http://www.esa.int/mass">
			<xmlRequest/>
			<string>mass:processSearchInputMsg/mass:searchInput/eoli:searchRequest/eoli:cursor</string>
		</xPath>
	</setVariable>
	<setVariable name="iteratorSize">
		<xPath xmlns:eoli="http://earth.esa.int/XML/eoli" xmlns:mass="http://www.esa.int/mass">
			<xmlRequest/>
			<string>mass:processSearchInputMsg/mass:searchInput/eoli:searchRequest/eoli:iteratorSize</string>
		</xPath>
	</setVariable>
	<if>
		<oneq>
			<variable name="presentation"/>
			<string/>
		</oneq>
		<setVariable name="requestedResultSetSize">
			<itoa>
				<plus>
					<atoi>
						<variable name="cursor"/>
					</atoi>
					<atoi>
						<variable name="iteratorSize"/>
					</atoi>
					<literal value="-1"/>
				</plus>
			</itoa>
		</setVariable>
	</if>
	<setVariable name="DBURL">
		<string>jdbc:informix-sqli://www.acsys.it:1537/kes:INFORMIXSERVER=wwwInformix</string>
	</setVariable>
	<setVariable name="password">
		<string>tseug</string>
	</setVariable>
	<setVariable name="userName">
		<string>guest</string>
	</setVariable>
	<setVariable name="connection">
		<dbConnect autoCommit="false" driver="com.informix.jdbc.IfxDriver">
			<variable name="DBURL"/>
			<variable name="userName"/>
			<variable name="password"/>
		</dbConnect>
	</setVariable>
	<setVariable name="ROI">
		<methodInvocation methodName="fetch">
			<class>
				<classLiteral class="it.intecs.pisa.soap.toolbox.services.util.ROIFetcher2"/>
			</class>
			<parameter>
				<classLiteral class="org.w3c.dom.Document"/>
				<xmlRequest/>
			</parameter>
		</methodInvocation>
	</setVariable>
	<setVariable name="tempQueryString">
		<xslt xmlOutput="false">
			<xmlRequest/>
			<variable name="txml2sql"/>
			<parameter name="roi">
				<variable name="ROI"/>
			</parameter>
		</xslt>
	</setVariable>
	<setVariable name="queryString">
		<xslt xmlOutput="false">
			<xmlRequest/>
			<variable name="xml2sql"/>
			<parameter name="roi">
				<variable name="ROI"/>
			</parameter>
			<parameter name="httpBasePath">
				<variable name="HTTP_BASE_PATH"/>
			</parameter>
			<parameter name="databladeScaleX">
				<variable name="DATABLADE_SCALE_X"/>
			</parameter>
			<parameter name="databladeScaleY">
				<variable name="DATABLADE_SCALE_Y"/>
			</parameter>
			<parameter name="databladeInterp">
				<variable name="DATABLADE_INTERP"/>
			</parameter>
			<parameter name="serverPath">
				<variable name="SERVER_PATH"/>
			</parameter>
			<parameter name="substringStartIndex">
				<variable name="SUBSTRING_START_IDEX"/>
			</parameter>
			<parameter name="requestedResultSetSize">
				<variable name="requestedResultSetSize"/>
			</parameter>
		</xslt>
	</setVariable>
	<!-- start part having ONLY debug purposes-->
	<log level="INFO">
		<stringCat>
			<string>tempQueryString: </string>
			<variable name="tempQueryString"/>
		</stringCat>
	</log>
	<!-- end part having ONLY debug purposes-->
	<dbExecute>
		<variable name="connection"/>
		<variable name="tempQueryString"/>
	</dbExecute>
	<!-- start part having ONLY debug purposes-->
	<dumpFile>
		<string>/home/toolbox/ACS/queryString.txt</string>
		<variable name="queryString"/>
	</dumpFile>
	<!-- end part having ONLY debug purposes-->
	<setVariable name="sqlResult">
		<dbQuery>
			<variable name="connection"/>
			<variable name="queryString"/>
		</dbQuery>
	</setVariable>
	<try>
		<sequence>
			<execute>
				<procedure>
					<stringCat>
						<variable name="instDir"/>
						<variable name="presentation"/>
						<string>Script.xml</string>
					</stringCat>
				</procedure>
			</execute>
		</sequence>
		<ifError errorMessageName="errorMessage">
			<sequence>
				<!-- start part having ONLY debug purposes-->
				<log level="INFO">
					<string>Error</string>
				</log>
				<!-- end part having ONLY debug purposes-->
				<dbClose>
					<variable name="connection"/>
				</dbClose>
				<xml textTag="error" attributePrefix="x">
					<mass:processSearchOutputMsg xmlns:mass="http://www.esa.int/mass">
						<mass:searchOutput>
							<mass:statusInfo>
								<mass:statusId>1</mass:statusId>
								<mass:statusMsg>
									<error name="errorMessage"/>
								</mass:statusMsg>
							</mass:statusInfo>
						</mass:searchOutput>
					</mass:processSearchOutputMsg>
				</xml>
			</sequence>
		</ifError>
	</try>
</sequence>
