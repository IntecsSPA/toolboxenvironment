<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Service Management</title>


<link type="text/css" href="../images/page.css" rel="stylesheet">
</head>
<body bgcolor="#ffffff" text="#000000">
<h1>Creating a SHELL based WPS</h1>
<div class="content">
<div class="justify">

<p>This tutorial explains how to create a Web Processing Service starting from a shell script which processes the Compute Risk Index making available on the Web the functionalities of the program.</p>
<p>Prerequisite:</p>
<ul>
  <li>Toolbox 9.0 correctly installed on a Linux server (the tests and the tutorial have been done using an ubuntu 10 Server)</li>
  <li>GRASS 6.3 installed on the Linux server </li>
</ul>
</div>

  <p>The following files are used in the tutorial</p>
  <ul>
    <li><a href="WPS_SHELL/DescribeProcessAuto.xml">DescribeProcessAuto.xml</a>: the describe document defining the WPS processing input/output parameters</li>
    <li><a href="WPS_SHELL/shell_script.sh">shell_script.sh</a>: the shell script that implements the processing </li>
    <li><a href="WPS_SHELL/GetCapabilites_Request.xml">GetCapabilites_Request.xml</a>: the input message to test the GetCapabilities operation </li>
    <li><a href="WPS_SHELL/DescribeProcess_computeRiskIndex_Request.xml">DescribeProcess_computeRiskIndex_Request.xml</a>: the input message to test the the DescribeProcess operation. </li>
    <li><a href="WPS_SHELL/request_computeRiskIndex_async_ftp_TAS.xml">request_computeRiskIndex_async_ftp_TAS.xml</a>: the input message to test the execution of the computeRiskIndex processing using the asynchronous pattern based on the WS-Addressing specification. </li>
  </ul>
  <p></p>
Log into the Toolbox then select the <strong>Service management--&gt;Create a new service</strong> </div>
<div class="content">
  <p align="center"><img src="WPS_SHELL/WPS_S01.png" width="650" height="368"></p>
  <p>In the Create Web Processing Service (WPS) slide tab select the Service Info tab and enter the Service Identification parameters as specified in the figure above. </p>
  <p><img src="../images/note.gif" width="17" height="17"> <strong>The values reported in the images are an example for the tutorial. For an operational service enter meaningful values. All these values will be used to generate the GetCapabilities response.</strong> </p>
</div>
<div class="content">
  <p>Then select the Provider Info tab and enter the Service Provider Information.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S02.png" width="650" height="304"></p>
  <p>Select the Contact Info tab and enter the Service Contact Information.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S03.png" width="650" height="366"></p>
  <p>Then click on Create WPSService.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S04.png" width="926" height="383"></p>
  <p>Click on OK then deselect the &quot;Enable/disable Schema validation&quot;</p>
  <p><img src="../images/warning.gif" width="28" height="21"> <strong>You have to disable this feature only if you are going to use the asynchronous approach with the WS-Addressing (not OGC standard). This is due to an error in one of the Schema defined in the Spec. </strong></p>
  <p>Now select the Operation Management link in the top menu bar.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S05.png" width="926" height="300"></p>
  <p>Click on Add WPS processing to start the wizard.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S06.png" width="910" height="514"> </p>
  <p>Load the <a href="WPS_SHELL/DescribeProcessAuto.xml">DescribeProcessAuto.xml</a> file in the text area then click on the parse WPS Processing Describe Information button. The describe is now parsed if the document is correct the next step allows you to enter the processing logic. </p>
  <p>Load the <a href="WPS_SHELL/shell_script.sh">shell_script.sh</a> in the text area.</p>
  <p align="center"><img src="WPS_SHELL/WPS_S07.png" width="910" height="514"></p>
  <p>Click on Create WPS Process. </p>
  <p align="center"><img src="WPS_SHELL/WPS_S08.png" width="925" height="308"></p>
  <p>Two new operations have now been added and it is also now possible to invoke also the DescribeProcess and the Execute. </p>
  <p>To test the process created go on the Test Center section </p>
  <p align="center"><img src="WPS_GRASS/images/WPS_G10.png" width="933" height="331"></p>
  <p>Select the Toolbox Application Client </p>
  <p align="center"><img src="WPS_SHELL/WPS_S10.png" width="685" height="520"></p>
  <p>In the Toolbox Information section enter the URL of the Toolbox hosting the service you want to test (it should already be set with the correct URL) then click on Retrieve Services. The client connects to the Toolbox and populate the Select Service drop down list. Select the service you want to test. The client connects to the Toolbox and retrieve the list of the available operations.</p>
  <h4>Testing the GetCapabilities operation </h4>
  <p>Select the GetCapabilities and click on Create Request. </p>
  <p align="center"><img src="WPS_SHELL/WPS_S11.png" width="926" height="507"></p>
  <p>In the GetCapabilities Input tab load the <a href="WPS_SHELL/GetCapabilites_Request.xml">GetCapabilites_Request.xml</a> file, select the Synchronous Payload option then click on Send Request</p>
  <p align="center"><img src="WPS_SHELL/WPS_S12.png" width="926" height="507"></p>
  <p>The client sends the request to the service and displays the response in the GetCapabilities Outputtab </p>
  <p><img src="../images/note.gif" width="17" height="17"> <strong>The values returned should be the same entered when you have created the service.</strong> </p>
  <h4>Testing the DescribeProcess operation </h4>
  <p>Go back to the Toolbox Information section and select the DescribeProcess option in the Select Operation drop down list then click on Create Request</p>
  <p align="center"><img src="WPS_SHELL/WPS_S13.png" width="926" height="507"></p>
  <p>In the DescribeProcess Input tab load the <a href="WPS_SHELL/DescribeProcess_computeRiskIndex_Request.xml">DescribeProcess_computeRiskIndex_Request.xml</a> file, select the Synchronous Payload option then click on Send Request</p>
  <p>The client sends the request to the service and displays the response in the DescribeProcess Output tab </p>
  <p align="center"><img src="WPS_SHELL/WPS_S14.png" width="926" height="507"></p>
  <p><img src="../images/note.gif" width="17" height="17"> <strong>The message returned back has been created using the content of the sescribe.xml file you provided when you have create the processing.</strong> </p>
  <h4>&nbsp;</h4>
  <h4>Testing the ExecuteProcess_computeRiskIndex_ASYNC operation </h4>
  <p>Go back to the Toolbox Information section and select the ExecuteProcess_computeRiskIndex_ASYNC option in the Select Operation drop down list then click on Create Request</p>
  <p align="center"><img src="WPS_SHELL/WPS_S15.png" width="926" height="507"></p>
  <p>In the ExecuteProcess_TestOperation_ASYNC Input tab load the <a href="WPS_SHELL/request_computeRiskIndex_async_ftp_TAS.xml">request_computeRiskIndex_async_ftp_TAS.xml file</a>, select the SOAP message option. In the SOAP message look for the Address tag and change the content in order to point to your Toolbox installation. This link will be used to send back the response to a Push Server deployed on the Toolbox as a separate service. </p>
  <p>The Address tag content should be</p>
  <p>http:// &lt;TOOLBOX_ADDRESS&gt;:&lt;TOOLBOX_PORT&gt;/TOOLBOX/Push</p>
  <p>where </p>
  <ul>
    <li>&lt;TOOLBOX_ADDRESS&gt;: host to be used to access the Toolbox services (check the Toolbox configurationpage) </li>
    <li>&lt;TOOLBOX_PORT&gt;: port to be used to access the Toolbox services (check the Toolbox configurationpage)</li>
  </ul>
  <p><img src="../images/note.gif" width="17" height="17"> <strong>The service has as an input a netcdf file to be processed. In the test message we point to a file stored on an on line FTP server. Make sure that this file is accessible from the Toolbox Host (xlink:href=&quot;ftp://genesis:genesis,;@ftp.alcasat.net/wp8000/Automatic-Test-Case/CHIMERE_V200501H_AMARC3.nc&quot;) </strong></p>
  <p>Clickon Send Request. The client sends the request to the service and displays the response in the ExecuteProcess_TestOperation_ASYNC Output tab. In this approach the response sent back directly to the client is an acknowledge.</p>
  <p><img src="WPS_SHELL/WPS_S16.png" width="926" height="507"></p>
  <p> The real response will be sent back to the address (the content of the Address tag set above) specified in the request directly by the service when the processing is completed.</p>
  <p>To check the response messages go on the Test Center </p>
  <p><img src="WPS_SHELL/WPS_S17.png" width="926" height="282"></p>
  <p>Select the Push server section a page displaying all the responses pushed back to the test server is displayed </p>
  <p><img src="WPS_SHELL/WPS_S18.png" width="926" height="238"></p>
  <p>To inspect the results click on View </p>
  <p><img src="WPS_SHELL/WPS_S19.png" width="926" height="449"></p>
  <p>The number of responses sent to the server can be more than one if the service supports the status update (this is NOT supported in the tutorial scripts). Look for the latest message arrived and check if the process has been completed successfully.</p>
  <p>If so the response contains the output parameters filled. Inspect the file and look for the output parameters. One of the output element contains a Reference tag pointing to the resource to be downloaded</p>
  <p>&lt;wps:Reference xlink:href=&quot;http://genesis.pisa.intecs.it:80/TOOLBOX/manager?cmd=getServiceResource&amp;serviceName=ComputeRiskIndex&amp;relativePath=Log/27012011121436824/output/OutputRiskIndex&quot;/&gt;</p>
  <p>Paste the content of the xlink:href attribute in a a browser to download the result of the processing. </p>
  <p><img src="../images/note.gif" width="17" height="17"> <strong>In this approach the processing is asynchronous but uses the WPS 1.0.0 pattern. This means that the response received contains a reference to an XML file that will be updated by the service to notify when the response is ready. The real response will be contained in this file. See <a href="../WPSAsynch.html">here</a> for more information.</strong></p>
</div>
</body>
</html>